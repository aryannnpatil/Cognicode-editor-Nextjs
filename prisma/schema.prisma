generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  clerkId String   @unique
  name    String?
  email   String?  @unique
  image   String?
  role    UserRole @default(USER)

  myPlaygrounds Playground[]
  staredPlaygrounds StarMark[]


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum UserRole {
  ADMIN
  USER
  PREMIUM_USER
}

// Template Options
enum Templates {
REACT 
NEXTJS
EXPRESS
DJANGO
VUE 
HONO
ANGULAR
}

// Playground Model

model Playground{
  id         String     @id @default(cuid()) @map("_id")
  title        String
  description String?
  template    Templates @default(REACT)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  StarMark StarMark[]

  userId String @db.ObjectId
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

 
  templateFiles TemplateFiles[]
}


// Model to track which Playgrounds are starred by which Users
model StarMark{
  id        String     @id @default(cuid()) @map("_id")
  userId     String
  playgroundId String
  isMarked  Boolean   @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  playground Playground @relation(fields: [playgroundId], references: [id], onDelete: Cascade)

  @@unique([userId, playgroundId])
}



// Template Files associated with each Playground
model TemplateFiles {
  id        String     @id @default(cuid()) @map("_id")
  playgroundId String @unique
  content   Json
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  playground Playground @relation(fields: [playgroundId], references: [id], onDelete: Cascade)
}